@Library('SnykShared@master')                                                                                                           
import com.symphony.security.containers.Artifactory


node {

    def snyk_image = 'slex-reg-test/snyk-release:experimental'
    def artifactory_url = 'artifact.symphony.com'
    stage('Hello World') {
        echo 'hello World'
        sh 'pwd'
        sh 'docker --version'
    }

    stage('Test with Docker') {
        echo 'test with docker'
        sh 'docker run --rm -i alpine:3.13 cat /etc/os-release'
        
    }

    stage('get stuff') {
        artfactory = new Artifactory(this)
        artfactory.pull(snyk_image)

        
        withCredentials([susernamePassword(credentialsId: 'githubaccess', usernameVariable: 'git_username', passwordVariable: 'git_password')]) {
            def params = "-e GIT_USER=${git_username} -e GIT_PASS=${git_password}"
            params += " -e MVN_PASS='' -e NPM_PASS='' "
            params += " -e SNYK_SCAN='test' -e SNYK_TOKEN='' -e SNYK_ORG='' -e PRJ_REPO='github.com/SymphonyOSF/SFE-Client-App.git' "
            params += " -e PRJ=SFE-Client-App -e GIT_HASH=20.12 " 
            sh "docker run --rm ${params} ${artifactory_url}/${snyk_image} scan_node_prj.sh"
        }
    }
}

        
